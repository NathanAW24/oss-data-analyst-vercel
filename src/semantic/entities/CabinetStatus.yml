name: CabinetStatus
type: fact_table
table: opendcim.cabinet_status
grain: one row per cabinet status snapshot
description: Cabinet operational status including power, temperature, and capacity.
common_questions:
  - Which cabinets are Critical or Running in each data center?
  - What is the average temperature per row and column?
  - Which cabinets have the highest power consumption?

dimensions:
  - name: data_center
    sql: data_center
    type: string
    description: Data center code for the cabinet

  - name: cabinet_id
    sql: cabinet_id
    type: string
    description: Unique cabinet identifier

  - name: row
    sql: row
    type: number
    description: Row number of the cabinet within the data center

  - name: col
    sql: col
    type: number
    description: Column number of the cabinet within the row

  - name: status
    sql: status
    type: string
    description: Current cabinet status
    sample_values: [Running, Critical]

  - name: power_consumed
    sql: power_consumed
    type: number
    description: Power consumed by the cabinet (kW)

  - name: rack_capacity
    sql: rack_capacity
    type: number
    description: Total rack capacity in rack units (RU)

  - name: average_temp
    sql: average_temp
    type: number
    description: Average cabinet temperature in Celsius

  - name: critical_events
    sql: critical_events
    type: number
    description: Count of critical events logged for the cabinet

measures:
  - name: cabinet_count
    sql: cabinet_id
    type: count_distinct
    description: Count of cabinets

  - name: avg_power_consumed
    sql: power_consumed
    type: avg
    description: Average power consumption per cabinet

  - name: avg_temperature
    sql: average_temp
    type: avg
    description: Average cabinet temperature

  - name: total_critical_events
    sql: critical_events
    type: sum
    description: Total critical events across cabinets

joins:
  - target_entity: RegionDataCenterMapping
    relationship: many_to_one
    join_columns:
      from: data_center
      to: data_center

  - target_entity: ServerStatus
    relationship: one_to_many
    join_columns:
      from: cabinet_id
      to: cabinet_id
